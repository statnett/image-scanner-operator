---
apiVersion: v1
kind: Service
metadata:
  name: metrics
  namespace: image-scanner
spec:
  ports:
    - name: metrics
      port: 80
      protocol: TCP
      targetPort: metrics
  selector:
    control-plane: image-scanner
---
apiVersion: v1
kind: Pod
metadata:
  name: metrics-up
  namespace: image-scanner
spec:
  restartPolicy: Never
  containers:
    - name: run
      image: docker.io/curlimages/curl
      command:
        - /bin/sh
        - -c
      args:
        - >-
          curl -s "http://metrics.image-scanner.svc.cluster.local:80/metrics" | grep certwatcher_read_certificate_errors_total;
