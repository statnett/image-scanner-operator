---
apiVersion: v1
kind: Pod
metadata:
  name: metrics-custom
spec:
  restartPolicy: Never
  containers:
    - name: run
      image: quay.io/curl/curl
      command:
        - /bin/sh
        - -c
      args:
        - |
          for i in $(seq 1 5); do
            if curl -s "http://metrics.image-scanner.svc.cluster.local:80/metrics" \
               | grep -q "image_scanner_container_image_issues"; then
              echo "Metric found!"
              exit 0
            else
              echo "Metric not found, attempt $i/5"
              sleep 2
            fi
          done
          echo "Metric not found after 5 attempts"
          exit 1
